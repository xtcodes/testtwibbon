<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Result</title>
<style>
body, html { margin:0; padding:0; font-family:Arial, sans-serif; background:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; }
#canvas { border-radius:50%; }
#downloadBtn { margin-top:20px; padding:10px 20px; font-size:1rem; cursor:pointer; }
</style>
</head>
<body>

<canvas id="canvas" width="200" height="200"></canvas>
<button id="downloadBtn">Download PFP</button>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const downloadBtn = document.getElementById('downloadBtn');
const userImage = localStorage.getItem('userImage');
const twibbonURL = 'https://i.ibb.co/7v3h1tW/twibbon.png';

if(!userImage){ window.location.href='../index.html'; }

const img = new Image();
const twibbon = new Image();
let loaded=0;
img.onload=checkLoad; twibbon.onload=checkLoad;
img.src=userImage; twibbon.src=twibbonURL;

function checkLoad(){
  loaded++;
  if(loaded<2) return;
  canvas.width=img.width; canvas.height=img.height;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.beginPath();
  ctx.arc(canvas.width/2, canvas.height/2, canvas.width/2, 0, Math.PI*2);
  ctx.closePath();
  ctx.clip();
  ctx.drawImage(img,0,0,canvas.width,canvas.height);
  ctx.restore();
  ctx.drawImage(twibbon,0,0,canvas.width,canvas.height);
}

downloadBtn.addEventListener('click',()=>{
  const link=document.createElement('a');
  link.href=canvas.toDataURL('image/png');
  link.download='twibbon_pfp.png';
  link.click();
});
</script>

</body>
</html>
