<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formatter HTML • CSS • JS</title>
<style>
body {
  font-family: monospace;
  background: #fafafa;
  color: #222;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding: 20px;
  height: 100vh;
  margin: 0;
}
.editor {
  width: 100%;
  max-width: 800px;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.editor-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f0f0f0;
  padding: 10px;
  font-size: 14px;
  border-bottom: 1px solid #ddd;
}
.tabs {
  display: flex;
  gap: 6px;
}
.tab {
  padding: 5px 10px;
  border-radius: 4px;
  cursor: pointer;
  color: #777;
  border: 1px solid transparent;
}
.tab.active {
  background: #0078d4;
  color: white;
  border-color: #0078d4;
}
.editor-body {
  display: flex;
  height: 70vh;
  position: relative;
}
.line-numbers {
  background: #f8f8f8;
  color: #999;
  text-align: right;
  padding: 8px 5px;
  user-select: none;
  overflow: hidden;
  white-space: pre;
  border-right: 1px solid #ddd;
  min-width: 40px;
}
textarea {
  flex: 1;
  background: white;
  color: #222;
  border: none;
  resize: none; /* Mengubah ini agar tidak bisa resize */
  outline: none;
  padding: 8px 10px;
  font-size: 14px;
  font-family: monospace;
  line-height: 1.4;
  overflow: auto;
  white-space: pre;
}
button {
  background: #0078d4;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 8px 12px;
  cursor: pointer;
  font-size: 14px;
  margin: 10px;
  align-self: flex-start;
  transition: background 0.2s;
}
button:hover {
  background: #0a6ec5;
}
</style>
</head>
<body>

<div class="editor">
  <div class="editor-header">
    <span><b>Formatter VSCode Style</b></span>
    <div class="tabs">
      <div class="tab active" data-type="html">HTML</div>
      <div class="tab" data-type="css">CSS</div>
      <div class="tab" data-type="js">JS</div>
    </div>
  </div>

  <div class="editor-body">
    <div class="line-numbers" id="lines">1</div>
    <textarea id="codeInput" placeholder="// Tulis kode di sini..."></textarea>
  </div>

  <button id="btnFormat">Format</button>
</div>

<script>
let currentTab = "html";
const codeInput = document.getElementById("codeInput");
const lines = document.getElementById("lines");
const btnFormat = document.getElementById("btnFormat");
const tabs = document.querySelectorAll(".tab");
const storage = { html: "", css: "", js: "" };

// --- FUNGSI UTAMA ---

function updateLineNumbers() {
  const totalLines = (codeInput.value.trim() === "") ? 1 : codeInput.value.split("\n").length;
  lines.textContent = Array.from({length: totalLines}, (_, i) => i + 1).join("\n");
  lines.scrollTop = codeInput.scrollTop; // Sinkronkan scroll
}

codeInput.addEventListener("input", updateLineNumbers);
codeInput.addEventListener("scroll", updateLineNumbers); // Gunakan fungsi yang sama
updateLineNumbers();

tabs.forEach(tab => {
  tab.addEventListener("click", () => {
    tabs.forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    // Simpan konten tab lama sebelum berpindah
    storage[currentTab] = codeInput.value;
    currentTab = tab.dataset.type;
    // Muat konten tab baru
    codeInput.value = storage[currentTab];
    updateLineNumbers();
    // Atur placeholder sesuai tab
    const placeholder = currentTab === 'html' ? '' :
                        currentTab === 'css' ? '/* Tulis kode CSS di sini... */' :
                        '// Tulis kode JavaScript di sini...';
    codeInput.setAttribute('placeholder', placeholder);
  });
});

btnFormat.addEventListener("click", () => {
  let val = codeInput.value.trim();
  if (!val) {
    alert("Masukkan kode terlebih dahulu!");
    return;
  }

  // --- VALIDASI SEBELUM FORMAT ---
  let isValid = true;
  if (currentTab === "html" && !isValidHTML(val)) {
    alert("Kode yang dimasukkan sepertinya bukan HTML yang valid. Periksa kembali tag dan strukturnya!");
    isValid = false;
  } else if (currentTab === "css" && !isValidCSS(val)) {
    alert("Kode yang dimasukkan sepertinya bukan CSS yang valid. Pastikan ada kurung kurawal ({}) dan titik koma (;)");
    isValid = false;
  } else if (currentTab === "js" && !isValidJS(val)) {
    alert("Kode yang dimasukkan sepertinya bukan JavaScript yang valid. Periksa tanda kurung, kurawal, dan sintaks lainnya.");
    isValid = false;
  }

  if (!isValid) return;
  // --- END VALIDASI ---

  let formatted = val;
  if (currentTab === "html") formatted = formatHTML(val);
  else if (currentTab === "css") formatted = formatCSS(val);
  else if (currentTab === "js") formatted = formatJS(val);

  codeInput.value = formatted;
  updateLineNumbers();
});

// --- FUNGSI VALIDASI SEDERHANA ---

// HTML: Harus memiliki setidaknya satu tag pembuka dan penutup (misal: <div>)
function isValidHTML(code) {
  // Mencari minimal satu tag HTML yang valid (misal: <a>, <p>, <div>, <h1>, dll)
  return /<[a-z][\s\S]*>/.test(code.toLowerCase());
}

// CSS: Harus memiliki setidaknya satu properti dan nilai di dalam kurung kurawal
function isValidCSS(code) {
  // Mencari selector, kurung kurawal, dan properti:nilai;
  return /^[^{]*\{[^}]*\:.*\;.*\}/ms.test(code.trim());
}

// JavaScript: Harus memiliki minimal satu keyword JS atau tanda kurung/titik koma (contoh sederhana)
function isValidJS(code) {
  // Mencari statement JS dasar seperti function, const, let, var, if, for, ;, atau ()
  const keywords = ['function', 'const', 'let', 'var', 'if', 'for', 'return'];
  const hasKeyword = keywords.some(keyword => new RegExp(`\\b${keyword}\\b`).test(code));
  const hasSyntax = /[\{\}\(\);]/.test(code);
  return hasKeyword || hasSyntax;
}

// --- FUNGSI FORMATTER YANG DITINGKATKAN (Beautify Sederhana) ---

// HTML Formatter yang lebih kuat
function formatHTML(html) {
  // Menghapus spasi ekstra di antara tag, kecuali di dalam komentar atau tag pre/code
  html = html.replace(/(>)\s*(<)([^!])/g, '$1\n$2$3');
  html = html.replace(/()/g, '\n$1\n'); // pisahkan komentar

  const lines = html.split('\n').filter(line => line.trim() !== '');
  let formatted = "", indent = 0;
  // Tag yang tidak memerlukan penutup/tidak menambah indentasi (void tags)
  const voidTags = ["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];

  for (let i = 0; i < lines.length; i++) {
    let line = lines[i].trim();

    // 1. Tag Penutup (e.g., </div>)
    if (/^<\/[^>]+>/.test(line)) {
      indent = Math.max(0, indent - 1); // Kurangi indentasi
      formatted += "  ".repeat(indent) + line + "\n";
    }
    // 2. Komentar, Doctype, atau Tag Mandiri (e.g., <br>)
    else if (/^<!/.test(line) || /^<br/.test(line) || /^<hr/.test(line) || /^<img/.test(line) || /^<input/.test(line) || /^<meta/.test(line) || /^\/\//.test(line)) {
      formatted += "  ".repeat(indent) + line + "\n";
    }
    // 3. Tag Pembuka (e.g., <div>)
    else if (/^<[^/!][^>]*[^/]?>/.test(line)) {
      formatted += "  ".repeat(indent) + line + "\n";
      const tagMatch = line.match(/^<(\w+)/);
      if (tagMatch && !voidTags.includes(tagMatch[1].toLowerCase())) {
        // Tag yang memerlukan penutup (non-void tag)
        indent++;
      }
    }
    // 4. Teks biasa di antara tag (dibiarkan apa adanya di level indentasi saat ini)
    else {
      formatted += "  ".repeat(indent) + line + "\n";
    }
  }
  return formatted.trim();
}

// CSS Formatter (Ditingkatkan sedikit dari aslinya)
function formatCSS(css) {
  // Membersihkan spasi di sekitar karakter khusus
  css = css.replace(/\s*([\{\};:,])\s*/g, '$1').trim();

  let indent = 0, out = '';
  for (let ch of css) {
    if (ch === '{') {
      out += ' {\n' + '  '.repeat(++indent);
    } else if (ch === '}') {
      indent--;
      out += '\n' + '  '.repeat(indent) + '}\n';
    } else if (ch === ';') {
      out += ';\n' + '  '.repeat(indent);
    } else if (ch === ',') { // Untuk multiple selector
        out += ', ';
    } else if (ch === ':') {
        out += ': '; // Tambahkan spasi setelah titik dua (properti: nilai)
    } else {
      out += ch;
    }
  }
  // Menghapus baris kosong ekstra yang mungkin muncul dari \n di akhir
  return out.replace(/(\n\s*){2,}/g, '\n\n').trim();
}


// JS Formatter (Ditingkatkan, mengurus statement baru)
function formatJS(js) {
  // Membersihkan spasi berlebihan
  js = js.replace(/\s+/g, ' ').trim();

  let indent = 0, out = '';
  // Tambahkan spasi sebelum dan sesudah kurung kurawal untuk pemisahan
  js = js.replace(/([\{\}])/g, ' $1 ').trim();
  // Tambahkan spasi setelah titik koma dan sebelum baris baru
  js = js.replace(/;/g, '; ');

  // Bagi berdasarkan spasi, dan gabungkan lagi dengan aturan indentasi
  const tokens = js.split(/\s+/).filter(Boolean);

  for (const token of tokens) {
    if (token === '{') {
      out += ' ' + token + '\n' + '  '.repeat(++indent);
    } else if (token === '}') {
      indent = Math.max(0, indent - 1);
      out = out.trimEnd() + '\n' + '  '.repeat(indent) + token + '\n' + '  '.repeat(indent);
    } else if (token === ';') {
      out += token + '\n' + '  '.repeat(indent);
    } else {
      // Tambahkan spasi jika bukan awal baris dan token sebelumnya bukan ; atau { atau }
      if (out.endsWith('\n' + '  '.repeat(indent))) {
        out += token;
      } else {
        out += ' ' + token;
      }
    }
  }

  // Bersihkan spasi berlebihan dan indentasi di awal
  return out.trim().replace(/(\n\s*){2,}/g, '\n\n');
}

</script>

</body>
      </html>
