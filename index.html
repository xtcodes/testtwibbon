<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Twibbon ‚Äî 3 Langkah (Sederhana)</title>
  <style>
    :root{
      --bg: #f3f3f3;
      --card: #ffffff;
      --accent: #60a5fa; /* biru muda */
      --muted: #6b7280;
      --radius: 12px;
      --maxw: 920px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:28px 16px;
      display:flex;
      justify-content:center;
    }
    .wrap{width:100%;max-width:var(--maxw)}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:18px}
    h1{font-size:18px;margin:0}
    .subtitle{color:var(--muted);font-size:13px}
    .card{background:var(--card);border-radius:var(--radius);padding:20px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    /* step layout */
    .steps{display:grid;grid-template-columns:1fr;gap:12px}
    .step{display:none}
    .step.active{display:block}
    .center{display:flex;align-items:center;justify-content:center}
    /* upload area */
    .upload-large{
      border:2px dashed #dbeafe;
      border-radius:10px;
      padding:28px;
      text-align:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), transparent);
      cursor:pointer;
    }
    .upload-large.hover{background:#eef7ff}
    .upload-large .icon{
      width:60px;height:60px;border-radius:12px;background:#fff;display:inline-flex;align-items:center;justify-content:center;box-shadow:0 4px 10px rgba(2,6,23,0.06);font-size:28px;color:var(--accent);
    }
    .upload-large p{margin:12px 0 6px;font-weight:600}
    .upload-large .muted{font-size:13px;color:var(--muted)}
    input[type=file]{display:none}
    /* controls */
    .actions{display:flex;gap:8px;margin-top:12px}
    button.primary{background:var(--accent);border:0;color:white;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid #e6edf8;color:var(--muted);padding:10px 12px;border-radius:10px;cursor:pointer}
    button[disabled]{opacity:0.6;cursor:not-allowed}
    /* preview small */
    .preview-small{width:160px;height:160px;border-radius:8px;overflow:hidden;border:1px solid #e8eefc;background:repeating-conic-gradient(#f6f9ff 0% 25%, #eef4ff 0% 50%) 50% / 16px 16px;display:flex;align-items:center;justify-content:center}
    .preview-small img{width:100%;height:100%;object-fit:contain;display:block}
    /* form */
    .field{margin-top:10px}
    input[type=text]{width:100%;padding:10px;border-radius:10px;border:1px solid #e6eef8;font-size:14px}
    /* gallery */
    .gallery-grid{
      margin-top:12px;
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(140px, 1fr));
      gap:12px;
    }
    .card-item{
      background:var(--card);border-radius:12px;padding:10px;text-align:center;border:1px solid rgba(2,6,23,0.04);
      display:flex;flex-direction:column;gap:8px;align-items:center;
    }
    .card-item .thumb{width:100%;height:120px;border-radius:8px;overflow:hidden;background:repeating-conic-gradient(#f0f0f0 0% 25%, #e6e6e6 0% 50%) 50% / 20px 20px;display:flex;align-items:center;justify-content:center}
    .card-item .thumb img{width:100%;height:100%;object-fit:contain;display:block}
    .card-item .title{font-size:14px;font-weight:600;color:#0f172a;word-break:break-word}
    .card-item .meta{font-size:12px;color:var(--muted)}
    /* footer small note */
    .note{font-size:13px;color:var(--muted);margin-top:10px;text-align:center}
    @media (max-width:640px){ .preview-small{width:120px;height:120px} .card-item .thumb{height:100px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Twibbon ‚Äî Buat & Bagikan (3 Langkah)</h1>
        <div class="subtitle">Langkah demi langkah agar tidak membingungkan pengguna</div>
      </div>
      <div class="subtitle">Tema: abu muda</div>
    </header>

    <main class="card">
      <!-- STEP INDICATOR -->
      <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center;flex-wrap:wrap">
        <div id="step1Indicator" style="padding:8px 12px;border-radius:999px;background:var(--accent);color:#fff;font-weight:700">1. Upload</div>
        <div id="step2Indicator" style="padding:8px 12px;border-radius:999px;background:#f1f5f9;color:var(--muted)">2. Nama & Simpan</div>
        <div id="step3Indicator" style="padding:8px 12px;border-radius:999px;background:#f1f5f9;color:var(--muted)">3. Galeri</div>
      </div>

      <div class="steps">
        <!-- STEP 1 -->
        <section id="step1" class="step active">
          <div style="display:flex;gap:18px;align-items:center;flex-wrap:wrap">
            <div style="flex:1;min-width:220px">
              <div id="dropArea" class="upload-large" tabindex="0">
                <div class="icon">üìÅ</div>
                <p>Unggah Twibbon (frame)</p>
                <div class="muted">Format: PNG dengan background transparan disarankan</div>
                <div class="muted" style="margin-top:8px;font-size:13px">Klik atau seret file ke area ini</div>
                <input id="fileInput" type="file" accept="image/*">
              </div>

              <div class="field" style="display:flex;gap:8px;align-items:center">
                <button id="toStep2" class="primary" disabled>Lanjut ke Langkah 2</button>
                <button id="clearStep1" class="ghost">Bersihkan</button>
              </div>
            </div>

            <div style="width:180px;text-align:center">
              <div style="font-size:13px;font-weight:700;margin-bottom:8px">Preview</div>
              <div class="preview-small" id="framePreview">
                <div class="muted">Belum ada</div>
              </div>
            </div>
          </div>
        </section>

        <!-- STEP 2 -->
        <section id="step2" class="step">
          <div style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap">
            <div style="flex:1;min-width:260px">
              <div style="font-weight:700;margin-bottom:6px">Beri Nama Twibbon</div>
              <input id="twibbonName" type="text" placeholder="Contoh: Hari Guru 2025">
              <div class="field" style="display:flex;gap:8px">
                <button id="saveToGallery" class="primary">Simpan ke Galeri</button>
                <button id="backTo1" class="ghost">Kembali</button>
              </div>
              <div class="note">Setelah disimpan, twibbon akan tampil di Galeri dan dapat dipakai orang lain.</div>
            </div>

            <div style="width:180px;text-align:center">
              <div style="font-size:13px;font-weight:700;margin-bottom:8px">Preview</div>
              <div class="preview-small" id="framePreview2">
                <div class="muted">Belum ada</div>
              </div>
            </div>
          </div>
        </section>

        <!-- STEP 3 -->
        <section id="step3" class="step">
          <div>
            <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
              <div style="font-weight:700">Galeri Twibbon</div>
              <div style="display:flex;gap:8px;align-items:center">
                <button id="addMore" class="primary">Tambah Twibbon</button>
                <button id="refreshGal" class="ghost">Refresh</button>
              </div>
            </div>

            <div id="gallery" class="gallery-grid" style="margin-top:12px"></div>

            <div class="note">Klik "Gunakan" untuk membuka editor: <code>editor.html?twibbon=&lt;id&gt;</code></div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    // ---------- Simple 3-step Twibbon (localStorage) ----------
    // Key for localStorage
    const STORAGE_KEY = 'twibbon_hub_v3';

    // Elements
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const step1Indicator = document.getElementById('step1Indicator');
    const step2Indicator = document.getElementById('step2Indicator');
    const step3Indicator = document.getElementById('step3Indicator');

    const fileInput = document.getElementById('fileInput');
    const dropArea = document.getElementById('dropArea');
    const framePreview = document.getElementById('framePreview');
    const framePreview2 = document.getElementById('framePreview2');
    const toStep2Btn = document.getElementById('toStep2');
    const clearStep1Btn = document.getElementById('clearStep1');

    const twibbonNameInput = document.getElementById('twibbonName');
    const saveToGalleryBtn = document.getElementById('saveToGallery');
    const backTo1Btn = document.getElementById('backTo1');

    const galleryEl = document.getElementById('gallery');
    const addMoreBtn = document.getElementById('addMore');
    const refreshGalBtn = document.getElementById('refreshGal');

    // state
    let currentFrameData = null; // dataURL
    let currentFrameBlob = null;

    // helpers
    function showStep(n){
      // 1,2,3
      step1.classList.remove('active');
      step2.classList.remove('active');
      step3.classList.remove('active');
      step1Indicator.style.background = '#f1f5f9'; step1Indicator.style.color = 'var(--muted)';
      step2Indicator.style.background = '#f1f5f9'; step2Indicator.style.color = 'var(--muted)';
      step3Indicator.style.background = '#f1f5f9'; step3Indicator.style.color = 'var(--muted)';
      if(n===1){ step1.classList.add('active'); step1Indicator.style.background = getComputedStyle(document.documentElement).getPropertyValue('--accent'); step1Indicator.style.color = '#fff'; }
      if(n===2){ step2.classList.add('active'); step2Indicator.style.background = getComputedStyle(document.documentElement).getPropertyValue('--accent'); step2Indicator.style.color = '#fff'; }
      if(n===3){ step3.classList.add('active'); step3Indicator.style.background = getComputedStyle(document.documentElement).getPropertyValue('--accent'); step3Indicator.style.color = '#fff'; }
    }

    function uid(){ return 'tw-'+Date.now()+'-'+Math.random().toString(36).slice(2,8); }

    function loadGallery(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }catch(e){
        return [];
      }
    }
    function saveGallery(list){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    function renderThumb(container, dataURL){
      container.innerHTML = '';
      const img = document.createElement('img');
      img.src = dataURL;
      img.alt = 'frame';
      img.onload = ()=>{}; // allow load
      container.appendChild(img);
    }

    // ------- Drop & file handling robust -------
    ;['dragenter','dragover'].forEach(ev => {
      dropArea.addEventListener(ev, e => { e.preventDefault(); dropArea.classList.add('hover'); });
    });
    dropArea.addEventListener('dragleave', e => { dropArea.classList.remove('hover'); });
    dropArea.addEventListener('drop', e => {
      e.preventDefault();
      dropArea.classList.remove('hover');
      const f = e.dataTransfer.files && e.dataTransfer.files[0];
      if(f) handleFile(f);
    });

    dropArea.addEventListener('click', ()=> fileInput.click());
    dropArea.addEventListener('keydown', e => { if(e.key === 'Enter' || e.key === ' ') fileInput.click(); });

    fileInput.addEventListener('change', e => {
      const f = e.target.files && e.target.files[0];
      if(f) handleFile(f);
      // clear so same file can be selected again later
      fileInput.value = '';
    });

    function handleFile(file){
      if(!file) return;
      if(!file.type.startsWith('image/')) return alert('Pilih file gambar (PNG/JPG).');
      const reader = new FileReader();
      reader.onload = ev => {
        currentFrameData = ev.target.result;
        renderThumb(framePreview, currentFrameData);
        renderThumb(framePreview2, currentFrameData);
        toStep2Btn.disabled = false;
      };
      reader.readAsDataURL(file);
    }

    clearStep1Btn.addEventListener('click', ()=>{
      currentFrameData = null;
      framePreview.innerHTML = '<div class="muted">Belum ada</div>';
      framePreview2.innerHTML = '<div class="muted">Belum ada</div>';
      toStep2Btn.disabled = true;
      twibbonNameInput.value = '';
    });

    // navigate
    toStep2Btn.addEventListener('click', ()=>{
      if(!currentFrameData) return alert('Unggah frame terlebih dahulu.');
      showStep(2);
    });
    backTo1Btn.addEventListener('click', ()=> showStep(1));

    // Save to gallery
    saveToGalleryBtn.addEventListener('click', ()=>{
      const name = (twibbonNameInput.value || '').trim();
      if(!name) return alert('Isi nama twibbon.');
      if(!currentFrameData) return alert('Tidak ada frame untuk disimpan.');

      const list = loadGallery();
      const item = {
        id: uid(),
        name,
        data: currentFrameData,
        created_at: new Date().toISOString()
      };
      list.unshift(item);
      saveGallery(list);

      // reset step1/2 state for next upload
      currentFrameData = null;
      twibbonNameInput.value = '';
      framePreview.innerHTML = '<div class="muted">Belum ada</div>';
      framePreview2.innerHTML = '<div class="muted">Belum ada</div>';
      toStep2Btn.disabled = true;

      // go to gallery step
      showStep(3);
      renderGallery();
      alert('Twibbon tersimpan ke galeri lokal. Jika mau agar semua orang dapat mengakses, integrasikan ke Supabase.');
    });

    // gallery
    function renderGallery(){
      const list = loadGallery();
      galleryEl.innerHTML = '';
      if(list.length === 0){
        galleryEl.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--muted)">Belum ada twibbon. Buat twibbon dulu di langkah 1.</div>';
        return;
      }
      for(const it of list){
        const card = document.createElement('div');
        card.className = 'card-item';
        const thumb = document.createElement('div'); thumb.className = 'thumb';
        const img = document.createElement('img'); img.src = it.data; img.alt = it.name;
        thumb.appendChild(img);

        const title = document.createElement('div'); title.className = 'title'; title.textContent = it.name;
        const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = new Date(it.created_at).toLocaleString();

        const btnWrap = document.createElement('div'); btnWrap.style.display = 'flex'; btnWrap.style.gap = '8px'; btnWrap.style.width='100%';
        const useBtn = document.createElement('button'); useBtn.className='primary'; useBtn.style.flex='1'; useBtn.textContent='Gunakan';
        useBtn.addEventListener('click', ()=> {
          // open editor page with twibbon id
          window.location.href = `editor.html?twibbon=${encodeURIComponent(it.id)}`;
        });
        const delBtn = document.createElement('button'); delBtn.className='ghost'; delBtn.style.flex='1'; delBtn.textContent='Hapus';
        delBtn.addEventListener('click', ()=>{
          if(!confirm('Hapus twibbon ini dari galeri?')) return;
          const filtered = loadGallery().filter(x=>x.id !== it.id);
          saveGallery(filtered);
          renderGallery();
        });

        btnWrap.appendChild(useBtn); btnWrap.appendChild(delBtn);

        card.appendChild(thumb);
        card.appendChild(title);
        card.appendChild(meta);
        card.appendChild(btnWrap);

        galleryEl.appendChild(card);
      }
    }

    addMoreBtn.addEventListener('click', ()=> showStep(1));
    refreshGalBtn.addEventListener('click', renderGallery);

    // init
    (function init(){
      showStep(1);
      framePreview.innerHTML = '<div class="muted">Belum ada</div>';
      framePreview2.innerHTML = '<div class="muted">Belum ada</div>';
      renderGallery();
    })();

    // Note: jika nanti ingin integrasi Supabase:
    // - simpan file ke Supabase Storage dan metadata (id, name, path) ke tabel 'twibbons'
    // - ganti loadGallery()/saveGallery() untuk memakai Supabase API
    // - nanti saya bantu tulis kode Supabase-nya jika kamu mau
  </script>
</body>
</html>
