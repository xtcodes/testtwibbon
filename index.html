<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PFP Twibbon</title>
<style>
  body, html {
    margin: 0; padding: 0;
    font-family: Arial, sans-serif;
  }

  /* Loading awal */
  #loadingScreen {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    background:#fff;
    display:flex; align-items:center; justify-content:center;
    font-size:2rem; z-index:9999;
  }

  /* Main Content (Artikel + Drop Area) */
  #mainContent {
    display:none;
    padding:20px;
    text-align:center;
  }
  #dropArea {
    width:100%; max-width:400px;
    aspect-ratio:1/1;
    border:2px dashed #aaa;
    border-radius:12px;
    margin:20px auto;
    display:flex; align-items:center; justify-content:center;
    color:#888; cursor:pointer;
    transition:border-color 0.3s;
  }
  #dropArea.hover { border-color:#555; }

  /* Proses Upload / Loading Gambar */
  #processing {
    display:none;
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:#fff;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    z-index:9999;
  }
  #userPhoto {
    width:150px; height:150px;
    border-radius:50%;
    object-fit:cover;
    position:relative; z-index:2;
  }
  .spinner {
    position:absolute; width:200px; height:200px;
    top:50%; left:50%; transform:translate(-50%, -50%);
  }
  .spinner .circle {
    position:absolute; width:100%; height:100%;
    border:6px solid transparent;
    border-top:6px solid #3498db;
    border-radius:50%;
    animation:spin 1s linear infinite;
  }
  .spinner .circle:nth-child(2) {
    border-top:6px solid #e74c3c;
    animation-direction:reverse;
  }
  @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }

  #processTip {
    margin-top:220px;
    font-weight:bold; font-size:1.2rem;
  }

  /* Result */
  #resultScreen {
    display:none;
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:#fff;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
  }
  #finalImage {
    width:200px; height:200px;
    border-radius:50%; object-fit:cover;
    position:relative;
  }
  #downloadBtn {
    margin-top:20px; padding:10px 20px; font-size:1rem;
    cursor:pointer;
  }
</style>
</head>
<body>

<!-- Loading Awal -->
<div id="loadingScreen">Loading...</div>

<!-- Main Content -->
<div id="mainContent">
  <div id="article">
    <h2>Proyek PFP Twibbon</h2>
    <p>Unggah gambar Anda untuk membuat PFP dengan twibbon interaktif. Proses akan berjalan beberapa detik.</p>
  </div>
  <div id="dropArea">Klik atau seret gambar di sini</div>
  <input type="file" id="fileInput" accept="image/*" style="display:none;">
</div>

<!-- Proses Upload -->
<div id="processing">
  <img id="userPhoto" src="" alt="User Photo">
  <div class="spinner">
    <div class="circle"></div>
    <div class="circle"></div>
  </div>
  <div id="processTip">1/5</div>
</div>

<!-- Result Screen -->
<div id="resultScreen">
  <img id="finalImage" src="" alt="Twibbon Result">
  <button id="downloadBtn">Download PFP</button>
</div>

<script>
const loadingScreen = document.getElementById('loadingScreen');
const mainContent = document.getElementById('mainContent');
const dropArea = document.getElementById('dropArea');
const fileInput = document.getElementById('fileInput');
const processing = document.getElementById('processing');
const userPhoto = document.getElementById('userPhoto');
const processTip = document.getElementById('processTip');
const resultScreen = document.getElementById('resultScreen');
const finalImage = document.getElementById('finalImage');
const downloadBtn = document.getElementById('downloadBtn');

// Loading awal 10 detik
setTimeout(()=>{
  loadingScreen.style.display='none';
  mainContent.style.display='block';
},10000);

// DropArea events
dropArea.addEventListener('click',()=>fileInput.click());
dropArea.addEventListener('dragover', e=>{e.preventDefault(); dropArea.classList.add('hover');});
dropArea.addEventListener('dragleave', ()=>dropArea.classList.remove('hover'));
dropArea.addEventListener('drop', e=>{
  e.preventDefault(); dropArea.classList.remove('hover');
  if(e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', ()=>{ if(fileInput.files.length) handleFile(fileInput.files[0]); });

function handleFile(file){
  const reader = new FileReader();
  reader.onload = e=>{
    userPhoto.src=e.target.result;
    mainContent.style.display='none';
    processing.style.display='flex';
    startProcessTip(e.target.result);
  };
  reader.readAsDataURL(file);
}

// Proses tip 1/5 â†’ 5/5 repeat 10 detik
function startProcessTip(imageSrc){
  let step=1;
  const totalSteps=5;
  const duration=10000; // 10 detik
  const intervalTime=duration/(totalSteps*2); // repeat ~2x
  const startTime=Date.now();
  const interval=setInterval(()=>{
    processTip.textContent=`${step}/${totalSteps}`;
    step++;
    if(step>totalSteps) step=1;
    if(Date.now()-startTime>=duration){
      clearInterval(interval);
      showResult(imageSrc);
    }
  },intervalTime);
}

// Tampilkan hasil PFP + Twibbon default
function showResult(imageSrc){
  processing.style.display='none';
  resultScreen.style.display='flex';
  // Simpel gabungkan user + twibbon
  finalImage.src=imageSrc; // nanti bisa overlay twibbon
}

// Download tombol
downloadBtn.addEventListener('click',()=>{
  const link=document.createElement('a');
  link.href=finalImage.src;
  link.download='twibbon_pfp.png';
  link.click();
});
</script>
</body>
</html>
